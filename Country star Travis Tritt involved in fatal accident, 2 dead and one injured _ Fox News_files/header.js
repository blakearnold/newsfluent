/*! updated; 05-06-2019 11:55 AM **/


Modulr.define("core.base:modules/header",["require","utils/environment","core.plugins:OnWindowResize","core.base:utils/detector","core.plugins:DateTime","modules/weather","modules/hot-topics","core.base:utils/akamai"],function(require){var OnWindowResize=require("core.plugins:OnWindowResize"),Detector=require("core.base:utils/detector"),Weather=require("modules/weather"),HotTopics=require("modules/hot-topics"),Time=require("core.base:utils/akamai").time,view=Detector.current();function Header(){this.body=$("html, body"),this.menu=$(".js-menu-toggle"),this.searchIcon=$(".site-header .js-focus-search"),this.siteHeader=$(".site-header"),this.menuMore=$(".menu-more"),this.searchField=$(".expandable-nav .search-wrap"),this.searchInput=$(".site-header .resp_site_search"),this.maginifyEl=$(".search-toggle")}return Header.prototype.init=function(){for(var key in Weather.init(),HotTopics.init(),this)"init"!==key&&"function"==typeof this[key]&&this[key]()},Header.prototype.setClickEvents=function(){var self=this;this.menu.click(function(e){e.preventDefault(),self.menuMore.hasClass("is-active")?self.menuMore.removeClass("is-active"):self.menuMore.addClass("is-active"),self.siteHeader.hasClass("nav-open")?self.siteHeader.removeClass("nav-open"):self.siteHeader.addClass("nav-open"),self.menu.hasClass("menu-open")?self.menu.removeClass("menu-open"):self.menu.addClass("menu-open")}),this.searchIcon.click(function(e){e.preventDefault(),self.siteHeader.hasClass("nav-open")?self.siteHeader.removeClass("nav-open"):self.siteHeader.addClass("nav-open"),self.menuMore.hasClass("is-active")?self.menuMore.removeClass("is-active"):($(".site-header .resp_site_search").focus(),self.menuMore.addClass("is-active"))}),this.searchField.find("input[type='submit']").click(function(e){$(this).closest("form[action]");0!==self.searchField.find("input[type='text']").val().length||e.preventDefault()}),this.body.unbind("click").on("click",function(e){var domEl=$(e.target),isToggleBtn=domEl.hasClass("menu-open");domEl.hasClass("resp_site_search")||0<domEl.closest(".inner").length||self.siteHeader.hasClass("nav-open")&&!isToggleBtn&&(self.siteHeader.removeClass("nav-open"),self.menuMore.removeClass("is-active"),self.menu.removeClass("menu-open"))}),this.searchInput.on("focus",function(e){require(["ISA"],function(ISA){ISA.provider("leapmetrics",function(Provider){Provider.get(function(Leap){Leap.track("search:start")})})}),self.maginifyEl.addClass("is-active")}).on("blur",function(e){self.maginifyEl.removeClass("is-active")})},Header.prototype.cycleHotTopics=function(){var hotTopics=$(".hot-topics .rotate-items li"),totalTime=5*hotTopics.length,win=$(window);function cycleHTUs(){hotTopics.each(function(index){var time=5*index;$(this).css("animation","rotate-items "+totalTime+"s infinite "+time+"s ease-in-out")})}function removeHTUStyles(){hotTopics.each(function(index){$(this).attr("style","")})}"tablet"===Detector.current()&&win.width()<1024||win.width()<1024?cycleHTUs():removeHTUStyles(),OnWindowResize(function(){win.width()<1024?cycleHTUs():removeHTUStyles()},250)},Header.prototype.setLocalTime=function(){require("helper");var now,timeElm,zoneElm,DateTime=require("core.plugins:DateTime"),CONFIG={container_selector:".branding .current-time",time_element_selector:".time",zone_element_selector:".zone",update:!0,rotate:!0,update_interval_in_min:1,rotate_interval_in_sec:6},update_timer=!1,rotate_timer=!1,isUSA=!1,Proto=this,timeZones=[{suffix:"ET",difference:0},{suffix:"CT",difference:1},{suffix:"MT",difference:2},{suffix:"PT",difference:3}],rotateItems=[{time:"channel",tz:""},{time:"$time",tz:"$tz"},{time:".com",tz:""},{time:"$time",tz:"$tz"},{time:"channel",tz:""},{time:"$time",tz:"$tz"},{time:"LIVE",tz:""},{time:"$time",tz:"$tz"}],currentTimeZone=!1,currentItem=0,localTimeZone=!1;Proto.collector=function(){var container=$(CONFIG.container_selector);timeElm=container.find(CONFIG.time_element_selector),zoneElm=container.find(CONFIG.zone_element_selector);var timeZoneFull=(now=Time.getCurrent()).toString().match(/\(([E|C|M|P][S|D]T)\)$/);if(timeZoneFull){var timeZoneShort=timeZoneFull[1].charAt(0)+timeZoneFull[1].charAt(2);-1<(localTimeZone=_.findIndex(timeZones,{suffix:timeZoneShort}))&&(currentTimeZone=localTimeZone,isUSA=!0)}},Proto.updater=function(increment){now=new Date(now.valueOf()+increment)},Proto.displayer=function(time,tz,animation_duration){animation_duration=void 0!==animation_duration?animation_duration:500,$(CONFIG.container_selector).fadeIn(animation_duration),0<timeElm.length&&0<zoneElm.length&&(timeElm.fadeOut(animation_duration),zoneElm.fadeOut(animation_duration,function(){time=0<tz.length?time+" ":time,timeElm.text(time),zoneElm.text(tz),timeElm.fadeIn(animation_duration),zoneElm.fadeIn(animation_duration)}))},Proto.rotator=function(){var index=currentItem%rotateItems.length;if("$time"===rotateItems[index].time)if(isUSA){var currentTZ=currentTimeZone%timeZones.length;currentTimeDelta=timeZones[currentTZ].difference;var time=new Date(now.valueOf());time=time.setHours(time.getHours()-currentTimeDelta),formattedTime=DateTime(new Date(time.valueOf()),"${hr:reg}:${min}"),Proto.displayer(formattedTime,timeZones[currentTZ].suffix),currentTimeZone++}else{var splitText=DateTime(now,"${hr:reg}:${min} ${AMPM}").split(" ");2===splitText.length&&Proto.displayer(splitText[0],splitText[1])}else"channel"===rotateItems[index].time?$(CONFIG.container_selector).fadeOut(500):Proto.displayer(rotateItems[index].time,rotateItems[index].tz);currentItem++},Proto.set=function(){"desktop"===Detector.current()||"tablet"===Detector.current()?(Proto.trigger({auto_update:"true"}),$(".site-header .current-time").removeClass("hide")):(clearInterval(rotate_timer),clearInterval(update_timer),$(".site-header .current-time").addClass("hide").css("style",""))},Proto.trigger=function(configuration){if(configuration&&(CONFIG=_.merge(CONFIG,configuration)),Proto.collector(),0<timeElm.length&&0<zoneElm.length){if(Proto.updater(0),Proto.rotator(),CONFIG.update){var updateInterval=6e4*CONFIG.update_interval_in_min;update_timer=setInterval(function(){Proto.updater(updateInterval)},updateInterval)}if(CONFIG.rotate){var rotateInterval=1e3*CONFIG.rotate_interval_in_sec;rotate_timer=setInterval(function(){Proto.rotator()},rotateInterval)}}},Proto.set(),OnWindowResize(function(){var currentView=Detector.current();("mobile"===view||"mobile"===currentView&&view!==currentView)&&(Proto.set(),view=currentView)},250)}(),new Header});